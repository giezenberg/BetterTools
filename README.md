Broken
===========
This code is partly broken and also pretty bad code. So if somebody wants to fix it go ahead and submit a PR.
